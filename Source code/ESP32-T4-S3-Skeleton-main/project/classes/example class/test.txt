#include "Tile4.hpp"

WeekTile::WeekTile(lv_obj_t* parent)
{
    tile_ = lv_tileview_add_tile(parent, 0, 1, LV_DIR_ALL);
    //lv_obj_clear_flag(tile_, LV_OBJ_FLAG_SCROLLABLE);

    lv_obj_set_size(tile_, LV_PCT(100), LV_PCT(100));   // Får aldrig auto-växa
    lv_obj_set_scroll_dir(tile_, LV_DIR_NONE);          // Ingen scroll inom tile


    title_ = lv_label_create(tile_);
    lv_label_set_text(title_, "7 Day Weather Forecast");
    lv_obj_set_style_text_font(title_, &lv_font_montserrat_32, 0);
    lv_obj_align(title_, LV_ALIGN_TOP_MID, 0, 10);

    // Layout: grid for 7 days
    static lv_coord_t col_dsc[] = {
        LV_GRID_FR(1), LV_GRID_FR(1), LV_GRID_FR(1), LV_GRID_FR(1),
        LV_GRID_FR(1), LV_GRID_FR(1), LV_GRID_FR(1),
        LV_GRID_TEMPLATE_LAST
    };

    static lv_coord_t row_dsc[] = {
        LV_SIZE_CONTENT,
        LV_GRID_TEMPLATE_LAST
    };

    lv_obj_set_grid_dsc_array(tile_, col_dsc, row_dsc);

    for(int i = 0; i < 7; i++)
    {
        // container för varje dag
        dayContainer[i] = lv_obj_create(tile_);
        lv_obj_set_size(dayContainer[i], LV_PCT(100), 120);

        lv_obj_set_grid_cell(dayContainer[i],
                             LV_GRID_ALIGN_STRETCH, i, 1,
                             LV_GRID_ALIGN_START,   1, 1);

        lv_obj_set_style_pad_all(dayContainer[i], 8, 0);
        lv_obj_set_style_bg_color(dayContainer[i], lv_color_hex(0x303030), 0);
        lv_obj_set_style_radius(dayContainer[i], 10, 0);

        // Dag-text
        label_day[i] = lv_label_create(dayContainer[i]);
        lv_label_set_text(label_day[i], "Mon");
        lv_obj_align(label_day[i], LV_ALIGN_TOP_MID, 0, 0);

        // Temperatur
        label_temp[i] = lv_label_create(dayContainer[i]);
        lv_label_set_text(label_temp[i], "12°C");
        lv_obj_align(label_temp[i], LV_ALIGN_CENTER, 0, 0);

        // Väderikon (placeholder)
        icon_weather[i] = lv_img_create(dayContainer[i]);
       // LV_IMG_DECLARE(icon_sun_16px);
       // lv_img_set_src(icon_weather[i], &icon_sun_16px);
        lv_obj_align(icon_weather[i], LV_ALIGN_BOTTOM_MID, 0, 0);
    }

    apply_bg_color(false);
    apply_text_color(title_, false);

    lv_obj_add_event_cb(tile_, WeekTile::gesture_cb, LV_EVENT_GESTURE, this);

}


void WeekTile::gesture_cb(lv_event_t* e)
{
    WeekTile* self = static_cast<WeekTile*>(lv_event_get_user_data(e));

    lv_dir_t dir = lv_indev_get_gesture_dir(lv_indev_get_act());

    if (dir == LV_DIR_TOP)
    {
        BaseTile::ShowGlobalOverlay("No Internet!", lv_color_hex(0xe74c3c));
    }
}
